language: generic
dist: bionic
sudo: required
services:
- docker
env:
  matrix:
  - IMAGE=30
  - IMAGE=30 TESTS=01
  - IMAGE=30 TESTS=12
  - IMAGE=30 TESTS=20
  - IMAGE=30 TESTS=50
  - IMAGE=30 TESTS=30
  - IMAGE=30 TESTS=31
  - IMAGE=30 TESTS=60
  - IMAGE=30 TESTS=70
  - IMAGE=30 TESTS=99
  - IMAGE=30 TESTS=02
  - IMAGE=30 TESTS=03
  - IMAGE=30 TESTS=04
  - IMAGE=30 TESTS=10
  - IMAGE=30 TESTS=11
  - IMAGE=30 TESTS=13
  - IMAGE=30 TESTS=14
  - IMAGE=30 TESTS=15
  - IMAGE=30 TESTS=17

before_script:
  - docker pull fedora:$IMAGE
  - |
    sudo modprobe kvm-intel nested=1 || :
    sudo modprobe kvm-amd nested=1 || :
    dmesg | tail || :
  - git fetch --tags --unshallow
  - |
    git describe --abbrev=0 --tags || :
    git describe --tags || :

script:
- docker run --privileged -it -v $(pwd)/:/dracut fedora:$IMAGE /dracut/fedora-test.sh $IMAGE-$$ "$TESTS"

notifications:
  webhooks:
    urls:
    - https://webhooks.gitter.im/e/effa917ca3e0ed5fd00e
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: never     # options: [always|never|change] default: always

